package com.ezen.book.controller;

import javax.inject.Inject;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.ezen.book.domain.MemberVO;
import com.ezen.book.domain.UnmemberVO;
import com.ezen.book.service.NonMemberService;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@RequestMapping("/nonMem/*")
@Controller
public class NonMemberController {

	@Inject
	private NonMemberService nmsv;
	
	@GetMapping("orderNumsearch")
	public String orderNumsearch() {
		return "/member/orderNumsearch";
	}
	@GetMapping("orderPWsearch")
	public String orderPWsearch() {
		return "/member/orderPWsearch";
	}
	@PostMapping("login")
	public String login(UnmemberVO umvo,HttpServletRequest req,RedirectAttributes reAttr, ) {
		UnmemberVO umvo2 = nmsv.login(umvo);
		if (mvo2 != null) {
			HttpSession ses = req.getSession();
			ses.setAttribute("ses", umvo2);
			ses.setMaxInactiveInterval(60*10);
			return "redirect:/";
		} else {
			reAttr.addFlashAttribute("msg", "0");
			return "redirect:/mem/login";
		}

	}
	
}

//////////////
@PostMapping("/login")
public String login(MemberVO mvo, RedirectAttributes reAttr, HttpServletRequest req) {
	MemberVO mvo2 = msv.login(mvo.getMem_id(), mvo.getMem_pw());
	log.info("login getMem_id : "+mvo.getMem_id());
	log.info("login getMem_pw : "+mvo.getMem_pw());
	if (mvo2 != null) {
		HttpSession ses = req.getSession();
		ses.setAttribute("ses", mvo2);
		ses.setMaxInactiveInterval(60*10);
		return "redirect:/";
	} else {
		reAttr.addFlashAttribute("msg", "0");
		return "redirect:/mem/loginPage";
	}

}

@GetMapping("/logOut")
public String logout(Model model, HttpServletRequest req, RedirectAttributes reAttr) {
	req.getSession().removeAttribute("ses");
	req.getSession().invalidate();
	
	return "redirect:/";

}